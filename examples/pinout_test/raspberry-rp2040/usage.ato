#pragma experiment("BRIDGE_CONNECT")
#pragma experiment("FOR_LOOP")
#pragma experiment("TRAITS")
import ElectricPower
import I2C
import USB2_0
import Resistor
import LDO
import has_part_removed

from "atopile/raspberry-rp2040/raspberry-rp2040.ato" import Raspberry_Pi_RP2040
from "atopile/st-ldk220/st-ldk220.ato" import LDK220M_R

from "parts/SHOU_HAN_TYPE_C_16PIN_2MD_073/SHOU_HAN_TYPE_C_16PIN_2MD_073.ato" import SHOU_HAN_TYPE_C_16PIN_2MD_073_package

module Usage:
    """Minimal example for the Raspberry Pi RP2040 microcontroller"""

    # MCU & sensor
    mcu = new Raspberry_Pi_RP2040
    sensor = new Sensor
    usb = new USBCConnector
    ldo = new LDK220M_R

    # power
    power_3v3 = new ElectricPower
    usb.usb.usb_if.buspower ~> ldo ~> power_3v3
    mcu.power ~ power_3v3
    sensor.power ~ power_3v3

    # usb data
    usb.usb ~ mcu.usb

    # I²C connection
    mcu.i2c ~ sensor.i2c


module Sensor:
    """Simplified sensor with I²C interface"""

    power = new ElectricPower
    i2c = new I2C
    trait has_part_removed

module USBCConnector:
    """Simplified USB-C connector"""
    package = new SHOU_HAN_TYPE_C_16PIN_2MD_073_package
    usb = new USB2_0

    cc_resistor = new Resistor[2]
    for resistor in cc_resistor:
        resistor.resistance = 51kohm +/- 1%
        resistor.package = "0402"

    usb.usb_if.buspower.hv ~ package.VBUS
    usb.usb_if.buspower.lv ~ package.GND
    usb.usb_if.buspower.lv ~ package.SHELL
    usb.usb_if.d.p.line ~ package.DP1
    usb.usb_if.d.p.line ~ package.DP2
    usb.usb_if.d.n.line ~ package.DN1
    usb.usb_if.d.n.line ~ package.DN2

    usb.usb_if.buspower.lv ~> cc_resistor[0] ~> package.CC1
    usb.usb_if.buspower.lv ~> cc_resistor[1] ~> package.CC2
