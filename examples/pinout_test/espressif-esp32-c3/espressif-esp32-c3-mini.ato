"""
Small-sized 2.4 GHz Wi-Fi (802.11b/g/n) and BluetoothÂ® 5 module
Built around ESP32-C3 series of SoCs, RISC-V single-core microprocessor
4 MB flash in chip package
15 GPIOs
On-board PCB antenna or external antenna connector
"""

#pragma experiment("MODULE_TEMPLATING")
#pragma experiment("BRIDGE_CONNECT")
#pragma experiment("FOR_LOOP")
#pragma experiment("TRAITS")
import ElectricPower
import Capacitor
import Resistor
import ElectricSignal
import ElectricLogic
import USB2_0_IF
import UART
import I2C
import I2S
import SPI
import JTAG
import MultiSPI
import XtalIF
import has_single_electric_reference_shared

# from "atopile/buttons/buttons.ato" import Button
# from "atopile/buttons/buttons.ato" import VerticalButton

from "espressif-esp32-c3.ato" import ESP32_C3FH4_model

from "parts/Espressif_Systems_ESP32_C3_MINI_1_N4/Espressif_Systems_ESP32_C3_MINI_1_N4.ato" import Espressif_Systems_ESP32_C3_MINI_1_N4_package
from "parts/Espressif_Systems_ESP32_C3_MINI_1U_H4/Espressif_Systems_ESP32_C3_MINI_1U_H4.ato" import Espressif_Systems_ESP32_C3_MINI_1U_H4_package

module ESP32_C3_MINI_1_base_model from ESP32_C3FH4_model:
    """
    Base module for ESP32-C3-MINI-1 and ESP32-C3-MINI-1U.
    Internally using the ESP32-C3FH4 chip.
    """

    # external interfaces
    power = new ElectricPower
    power_analog ~ power
    power_cpu ~ power
    power_rtc ~ power
    power_radio ~ power

    trait has_single_electric_reference_shared

module ESP32_C3_MINI_1_model from ESP32_C3_MINI_1_base_model:
    """
    ESP32-C3-MINI-1 module with build-in antenna and supporting components
    """
    package = new Espressif_Systems_ESP32_C3_MINI_1_N4_package

    # connections to package
    gpio[0].line ~ package.IO0
    gpio[1].line ~ package.IO1
    gpio[2].line ~ package.IO2
    gpio[3].line ~ package.IO3
    gpio[4].line ~ package.IO4
    gpio[5].line ~ package.IO5
    gpio[6].line ~ package.IO6
    gpio[7].line ~ package.IO7
    gpio[8].line ~ package.IO8
    gpio[9].line ~ package.IO9
    gpio[10].line ~ package.IO10
    gpio[18].line ~ package.IO18
    gpio[19].line ~ package.IO19
    gpio[20].line ~ package.RXD0
    gpio[21].line ~ package.TXD0
    enable.line ~ package.EN
    power.hv ~ package.P3V3
    power.lv ~ package.GND

module ESP32_C3_MINI_1U_model from ESP32_C3_MINI_1_base_model:
    """
    ESP32-C3-MINI-1U module with u.fl antenna connector and supporting components
    """
    package = new Espressif_Systems_ESP32_C3_MINI_1U_H4_package

    # connections to package
    gpio[0].line ~ package.IO0
    gpio[1].line ~ package.IO1
    gpio[2].line ~ package.IO2
    gpio[3].line ~ package.IO3
    gpio[4].line ~ package.IO4
    gpio[5].line ~ package.IO5
    gpio[6].line ~ package.IO6
    gpio[7].line ~ package.IO7
    gpio[8].line ~ package.IO8
    gpio[9].line ~ package.IO9
    gpio[10].line ~ package.IO10
    gpio[18].line ~ package.IO18
    gpio[19].line ~ package.IO19
    gpio[20].line ~ package.RXD0
    gpio[21].line ~ package.TXD0
    enable.line ~ package.EN
    power.hv ~ package.P3V3
    power.lv ~ package.GND
    power.lv ~ package.GNDNC

module ESP32_C3_MINI_1:
    """
    Reference driver for ESP32-C3-MINI-1 series of modules
    """
    esp32_c3 = new ESP32_C3_MINI_1_model  # defaults to ESP32-C3-MINI-1-N4 package

    # external interfaces
    power = new ElectricPower
    power.required = True
    gpio = new ElectricLogic[22]
    mspi = new MultiSPI[3]<data_lane_count = 4>
    uart = new UART[2]
    i2c = new I2C
    i2s = new I2S
    spi = new SPI
    usb_if = new USB2_0_IF  # TODO: should be USB2_0_IF.Data
    jtag = new JTAG
    adc1 = new ElectricSignal[5]
    adc2 = new ElectricSignal
    crystal_32k_interface = new XtalIF

    # connect to the base model
    gpio[0] ~ esp32_c3.gpio[0]
    gpio[1] ~ esp32_c3.gpio[1]
    gpio[2] ~ esp32_c3.gpio[2]
    gpio[3] ~ esp32_c3.gpio[3]
    gpio[4] ~ esp32_c3.gpio[4]
    gpio[5] ~ esp32_c3.gpio[5]
    gpio[6] ~ esp32_c3.gpio[6]
    gpio[7] ~ esp32_c3.gpio[7]
    gpio[8] ~ esp32_c3.gpio[8]
    gpio[9] ~ esp32_c3.gpio[9]
    gpio[10] ~ esp32_c3.gpio[10]
    gpio[18] ~ esp32_c3.gpio[18]
    gpio[19] ~ esp32_c3.gpio[19]
    gpio[20] ~ esp32_c3.gpio[20]
    gpio[21] ~ esp32_c3.gpio[21]
    mspi[0] ~ esp32_c3.mspi[0]
    mspi[1] ~ esp32_c3.mspi[1]
    mspi[2] ~ esp32_c3.mspi[2]
    uart[0] ~ esp32_c3.uart[0]
    uart[1] ~ esp32_c3.uart[1]
    i2c ~ esp32_c3.i2c
    i2s ~ esp32_c3.i2s
    spi ~ esp32_c3.spi
    usb_if ~ esp32_c3.usb_if
    jtag ~ esp32_c3.jtag
    adc1[0] ~ esp32_c3.adc1[0]
    adc1[1] ~ esp32_c3.adc1[1]
    adc1[2] ~ esp32_c3.adc1[2]
    adc1[3] ~ esp32_c3.adc1[3]
    adc1[4] ~ esp32_c3.adc1[4]
    adc2 ~ esp32_c3.adc2
    crystal_32k_interface ~ esp32_c3.crystal_32k_interface
    esp32_c3.power ~ power


