"""
Ultra-Low-Power SoC with RISC-V Single-Core CPU
2.4 GHz Wi-Fi (802.11b/g/n) and Bluetooth® 5 (LE)
Optional 4 MB flash in the chip's package
QFN32 (5x5 mm) package
"""

#pragma experiment("TRAITS")
#pragma experiment("FOR_LOOP")
#pragma experiment("BRIDGE_CONNECT")
#pragma experiment("MODULE_TEMPLATING")

import has_designator_prefix
import has_part_picked
import is_atomic_part

import ElectricPower
import ElectricSignal
import MultiSPI
import SPI
import I2C
import I2S
import USB2_0
import USB2_0_IF
import JTAG
import UART
import ElectricLogic
import XtalIF

module ESP32_C3_base_model:
    """
    All ESP32-C3 variants share the same base model.
    """
    # internal interfaces
    gpio = new ElectricLogic[22]
    # GPIO 2, default floating, used for boot configuration.
    # GPIO 8, default floating, used for boot configuration.
    # GPIO 9, default weak pull-up, used for boot configuration.
    mspi = new MultiSPI[3]<data_lane_count = 4>
    uart = new UART[2]
    i2c = new I2C
    i2s = new I2S
    spi = new SPI
    usb_if = new USB2_0_IF  # TODO: should be USB2_0_IF.Data
    jtag = new JTAG
    adc1 = new ElectricSignal[5]
    adc2 = new ElectricSignal
    crystal_interface = new XtalIF
    crystal_32k_interface = new XtalIF

    lna_interface = new ElectricSignal

    enable = new ElectricLogic
    boot_select = new ElectricLogic

    power_analog = new ElectricPower
    assert power_analog.voltage within 3.3V +/- 10%
    power_cpu = new ElectricPower
    assert power_cpu.voltage within 3.3V +/- 10%
    power_rtc = new ElectricPower
    assert power_rtc.voltage within 3.3V +/- 10%
    power_radio = new ElectricPower
    assert power_radio.voltage within 3.3V +/- 10%
    power_mspi = new ElectricPower
    assert power_mspi.voltage within 3.3V +/- 10%  # TODO: there is also a 1.1V mode?

    # non muxable internal connections
    gpio[0] ~ adc1[0]
    gpio[1] ~ adc1[1]
    gpio[2] ~ adc1[2]
    gpio[3] ~ adc1[3]
    gpio[4] ~ adc1[4]
    gpio[5] ~ adc2

    gpio[18] ~ usb_if.d.n
    gpio[19] ~ usb_if.d.p

    gpio[4] ~ jtag.tms
    gpio[5] ~ jtag.tdi
    gpio[6] ~ jtag.tck
    gpio[7] ~ jtag.tdo
    enable ~ jtag.n_trst

    # TODO: items below can be muxed by the GPIO-MUX to any pin.
    # the configuration below is for direct connection to the peripherals by the IO-MUX
    gpio[20] ~ uart[0].base_uart.rx
    gpio[21] ~ uart[0].base_uart.tx

    # mspi[0] and mspi[1] are used for internal/external flash
    mspi[0] ~ mspi[1]
    gpio[12] ~ mspi[0].data[3]  # SPIHD
    gpio[13] ~ mspi[0].data[2]  # SPIWP
    gpio[14] ~ mspi[0].chip_select
    gpio[15] ~ mspi[0].clock
    gpio[16] ~ mspi[0].data[0]  # SPID
    gpio[17] ~ mspi[0].data[1]  # SPIQ

    gpio[2] ~ mspi[2].data[1]  # SPIQ
    gpio[4] ~ mspi[2].data[3]  # SPIHD
    gpio[5] ~ mspi[2].data[2]  # SPIWP
    gpio[6] ~ mspi[2].clock
    gpio[7] ~ mspi[2].data[0]  # SPID
    gpio[10] ~ mspi[2].chip_select

    # TODO: below are some sensible defaults. These interfaces can be muxed to any GPIO.
    gpio[6] ~ i2c.scl
    gpio[5] ~ i2c.sda

    gpio[10] ~ spi.sclk
    gpio[7] ~ spi.mosi
    gpio[8] ~ spi.miso

    gpio[3] ~ i2s.ws
    gpio[1] ~ i2s.sd
    gpio[0] ~ i2s.sck

module ESP32_C3Fx4_base_model from ESP32_C3_base_model:
    """
    Package with build in 4MB flash.
    x can be H (High temperature) or N (Normal temperature)(end of life)
    """
    # flash = new Flash
    pass

module ESP32_C3_model from ESP32_C3_base_model:
    """
    ESP32-C3 without in package flash (external flash required).
    -40 ~ 105°C temperature range.
    22 GPIOs.
    Chip/die revision 0.4.
    """
    pass

module ESP32_C3FN4_model from ESP32_C3Fx4_base_model:
    """
    ESP32-C3 with in package 4MB flash.
    -40 ~ 85°C temperature range.
    22 GPIOs.
    Chip/die revision 0.4.
    End of life, discontinued.
    """
    pass

module ESP32_C3FH4_model from ESP32_C3Fx4_base_model:
    """
    ESP32-C3 with in package 4MB flash.
    -40 ~ 105°C temperature range.
    22 GPIOs.
    Chip/die revision 0.4.
    """
    pass

module ESP32_C3FH4AZ_model from ESP32_C3Fx4_base_model:
    """
    ESP32-C3 with in package 4MB flash.
    -40 ~ 105°C temperature range.
    16 GPIOs (SPI0/SPI1 pins for flash connection are not bonded).
    Chip/die revision 0.4.
    Not recommended for new designs.
    """
    pass

module ESP32_C3FH4X_model from ESP32_C3Fx4_base_model:
    """
    ESP32-C3 with in package 4MB flash.
    -40 ~ 105°C temperature range.
    16 GPIOs (SPI0/SPI1 pins for flash connection are not bonded).
    Chip/die revision 1.1.
    """
    pass
