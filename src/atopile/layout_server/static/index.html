<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PCB Layout Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Oxanium:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep:       #080c14;
            --surface:       rgba(12,18,32,0.82);
            --surface-solid:  #0f1524;
            --border:        rgba(255,255,255,0.07);
            --border-accent: rgba(224,160,56,0.25);
            --text-primary:  #e2e5ea;
            --text-secondary:#6b7280;
            --accent:        #e0a038;
            --accent-glow:   rgba(224,160,56,0.12);
            --active-green:  #4ade80;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            width: 100%; height: 100%; overflow: hidden;
            background: var(--bg-deep);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        canvas {
            display: block; width: 100vw; height: 100vh;
            cursor: crosshair;
        }

        /* ── Vignette overlay ── */
        #vignette {
            position: fixed; inset: 0;
            box-shadow: inset 0 0 120px rgba(0,0,0,0.3);
            pointer-events: none;
            z-index: 5;
        }

        /* ── Status bar — instrument readout strip ── */
        #status {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            background: var(--surface);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid var(--border);
            z-index: 30;
            font: 11px/1 'IBM Plex Mono', monospace;
            color: var(--text-secondary);
        }
        #status::before {
            content: '';
            position: absolute;
            top: -1px; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-accent), transparent);
        }
        #status-coords {
            font-family: 'Oxanium', sans-serif;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            color: var(--text-primary);
            letter-spacing: 0.02em;
            min-width: 180px;
        }
        #status-help {
            color: var(--text-secondary);
            font-size: 10px;
            text-align: right;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ── Layer panel ── */
        #layer-panel {
            position: fixed; top: 0; right: 0; bottom: 32px;
            width: 180px;
            background: var(--surface);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-left: 1px solid var(--border);
            border-radius: 4px 0 0 0;
            z-index: 20;
            font: 11px/1.4 'IBM Plex Mono', monospace;
            color: var(--text-primary);
            transform: translateX(0);
            transition: transform 0.2s ease;
            display: flex;
            flex-direction: column;
        }
        #layer-panel.collapsed {
            transform: translateX(100%);
        }

        .layer-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            font-family: 'Oxanium', sans-serif;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
            position: relative;
        }
        .layer-panel-header::after {
            content: '';
            position: absolute;
            bottom: -1px; left: 12px; right: 12px;
            height: 1px;
            background: var(--border-accent);
        }

        .layer-collapse-btn {
            cursor: pointer;
            opacity: 0.5;
            font-size: 10px;
            transition: opacity 0.15s;
            color: var(--text-secondary);
        }
        .layer-collapse-btn:hover { opacity: 1; color: var(--accent); }

        .layer-expand-tab {
            display: none;
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            writing-mode: vertical-rl;
            background: var(--surface);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-right: none;
            border-radius: 4px 0 0 4px;
            padding: 10px 5px;
            cursor: pointer;
            font: 11px 'Oxanium', sans-serif;
            font-weight: 600;
            color: var(--accent);
            z-index: 21;
            transition: background 0.15s;
        }
        .layer-expand-tab:hover {
            background: var(--accent-glow);
        }
        .layer-expand-tab.visible { display: block; }

        .layer-panel-content {
            overflow-y: auto;
            padding: 4px 0;
            flex: 1;
        }
        /* Custom scrollbar */
        .layer-panel-content::-webkit-scrollbar { width: 4px; }
        .layer-panel-content::-webkit-scrollbar-track { background: transparent; }
        .layer-panel-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.08);
            border-radius: 2px;
        }
        .layer-panel-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.14);
        }

        .layer-group-header {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 3px 12px;
            cursor: pointer;
            font-family: 'Oxanium', sans-serif;
            font-weight: 600;
            font-size: 11px;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            color: var(--text-secondary);
            transition: background 0.15s, color 0.15s;
        }
        .layer-group-header:hover {
            background: rgba(224,160,56,0.06);
            color: var(--text-primary);
        }

        .layer-chevron {
            font-size: 10px;
            width: 10px;
            text-align: center;
            flex-shrink: 0;
            color: var(--text-secondary);
        }

        .layer-group-name { flex: 1; }

        .layer-group-children {
            padding-left: 22px;
            overflow: hidden;
            transition: max-height 0.2s ease;
        }

        .layer-row {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            cursor: pointer;
            transition: background 0.15s;
            border-left: 2px solid transparent;
        }
        .layer-row:hover {
            background: rgba(224,160,56,0.06);
        }
        .layer-row.active {
            border-left-color: var(--accent);
        }

        .layer-top-level { padding-left: 22px; }

        .layer-swatch {
            display: inline-block;
            width: 12px; height: 4px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        /* ── BOM panel ── */
        #bom-panel {
            position: fixed; top: 0; left: 0; bottom: 32px;
            width: 240px;
            background: var(--surface);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-right: 1px solid var(--border);
            border-radius: 0 4px 0 0;
            z-index: 20;
            font: 11px/1.4 'IBM Plex Mono', monospace;
            color: var(--text-primary);
            transform: translateX(0);
            transition: transform 0.2s ease;
            display: flex;
            flex-direction: column;
        }
        #bom-panel.collapsed {
            transform: translateX(-100%);
        }
        .bom-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            font-family: 'Oxanium', sans-serif;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
            position: relative;
        }
        .bom-panel-header::after {
            content: '';
            position: absolute;
            bottom: -1px; left: 12px; right: 12px;
            height: 1px;
            background: var(--border-accent);
        }
        .bom-collapse-btn {
            cursor: pointer;
            opacity: 0.5;
            font-size: 10px;
            transition: opacity 0.15s;
            color: var(--text-secondary);
        }
        .bom-collapse-btn:hover { opacity: 1; color: var(--accent); }
        .bom-expand-tab {
            display: none;
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            writing-mode: vertical-rl;
            text-orientation: mixed;
            background: var(--surface);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-left: none;
            border-radius: 0 4px 4px 0;
            padding: 10px 5px;
            cursor: pointer;
            font: 11px 'Oxanium', sans-serif;
            font-weight: 600;
            color: var(--accent);
            z-index: 21;
            transition: background 0.15s;
        }
        .bom-expand-tab:hover { background: var(--accent-glow); }
        .bom-expand-tab.visible { display: block; }

        .bom-search {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 8px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .bom-search input {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            border-radius: 3px;
            color: var(--text-primary);
            font: 11px 'IBM Plex Mono', monospace;
            padding: 3px 6px;
            outline: none;
            min-width: 0;
        }
        .bom-search input:focus {
            border-color: var(--accent);
        }
        .bom-search input.bom-search-error {
            border-color: #e05050;
        }
        .bom-search-toggle {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 3px;
            color: var(--text-secondary);
            font: 10px 'IBM Plex Mono', monospace;
            padding: 2px 5px;
            cursor: pointer;
            transition: background 0.15s, color 0.15s;
            flex-shrink: 0;
        }
        .bom-search-toggle:hover { color: var(--text-primary); }
        .bom-search-toggle.active {
            background: var(--accent-glow);
            color: var(--accent);
            border-color: var(--border-accent);
        }

        .bom-table-header {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            font-family: 'Oxanium', sans-serif;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .bom-table-body {
            overflow-y: auto;
            flex: 1;
            min-height: 0;
        }
        .bom-table-body::-webkit-scrollbar { width: 4px; }
        .bom-table-body::-webkit-scrollbar-track { background: transparent; }
        .bom-table-body::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.08);
            border-radius: 2px;
        }
        .bom-table-body::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.14);
        }

        .bom-row {
            display: flex;
            align-items: center;
            padding: 3px 8px;
            cursor: pointer;
            transition: background 0.1s;
            border-left: 2px solid transparent;
        }
        .bom-row:hover { background: rgba(224,160,56,0.06); }
        .bom-row.selected {
            background: rgba(224,160,56,0.10);
            border-left-color: var(--accent);
        }

        .bom-qty {
            width: 28px;
            flex-shrink: 0;
            text-align: right;
            padding-right: 8px;
            font-variant-numeric: tabular-nums;
        }
        .bom-designators {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }
        .bom-value {
            width: 70px;
            flex-shrink: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-align: right;
            color: var(--text-secondary);
        }

        .bom-detail {
            border-top: 1px solid var(--border);
            padding: 8px;
            max-height: 200px;
            overflow-y: auto;
            flex-shrink: 0;
        }
        .bom-detail::-webkit-scrollbar { width: 4px; }
        .bom-detail::-webkit-scrollbar-track { background: transparent; }
        .bom-detail::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.08);
            border-radius: 2px;
        }
        .bom-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 1px 0;
            gap: 8px;
        }
        .bom-detail-label {
            color: var(--text-secondary);
            flex-shrink: 0;
            font-size: 10px;
        }
        .bom-detail-value {
            text-align: right;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
            font-size: 10px;
        }
        .bom-detail-loading {
            color: var(--text-secondary);
            font-size: 10px;
            text-align: center;
            padding: 8px;
        }
    </style>
</head>
<body>
    <canvas id="editor-canvas"></canvas>
    <div id="vignette"></div>
    <div id="bom-panel"></div>
    <div id="layer-panel"></div>
    <div id="status">
        <span id="status-coords"></span>
        <span id="status-help"></span>
    </div>
    <script type="module" src="static/editor.js"></script>
</body>
</html>
