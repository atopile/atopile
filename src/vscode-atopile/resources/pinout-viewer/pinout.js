import{r as m,j as e,i as P,a as S,R as k}from"./index-CntAr1-H.js";const N={Power:"#e06c75",I2C:"#61afef",SPI:"#c678dd",UART:"#e5c07b",I2S:"#56b6c2",USB:"#98c379",JTAG:"#d19a66",Crystal:"#abb2bf",Analog:"#be5046",GPIO:"#6b7280",Control:"#d19a66",Signal:"#4b5263"},O={power:"#e06c75",ground:"#555",signal:"#888",nc:"#3e4451"};function w(t){return t.active_function?N[t.active_function.type]||"#666":O[t.type]||"#666"}const f=16,A=3;function R({data:t}){const[o,r]=m.useState(0),[l,d]=m.useState(null),[s,i]=m.useState(null),[n,u]=m.useState(null),[p,x]=m.useState(!0),[h,y]=m.useState(""),g=t.components[o],v=m.useMemo(()=>{if(!h)return t.components;const a=h.toLowerCase();return t.components.filter(c=>c.name.toLowerCase().includes(a)||(c.designator||"").toLowerCase().includes(a)||(c.module_type||"").toLowerCase().includes(a))},[t.components,h]),b=m.useMemo(()=>{if(!g)return[];const a=new Set;return g.pins.forEach(c=>{c.active_function&&a.add(c.active_function.type),(c.type==="power"||c.type==="ground")&&a.add("Power")}),Object.keys(N).filter(c=>a.has(c))},[g]),j=m.useCallback((a,c)=>{c.stopPropagation(),s?.number===a.number?(i(null),u(null)):(i(a),u({x:c.clientX,y:c.clientY}))},[s]),C=m.useCallback(()=>{i(null),u(null),d(null)},[]);return g?e.jsxs("div",{className:"pinout-layout",children:[e.jsxs("div",{className:`pinout-panel ${p?"":"collapsed"}`,children:[e.jsxs("div",{className:"pinout-panel-header",children:[e.jsx("span",{children:"Components"}),e.jsx("button",{className:"pinout-panel-close",onClick:()=>x(!1),children:"×"})]}),e.jsx("div",{className:"pinout-panel-search",children:e.jsx("input",{placeholder:"Search...",value:h,onChange:a=>y(a.target.value)})}),e.jsx("div",{className:"pinout-comp-list",children:v.map(a=>{const c=t.components.indexOf(a);return e.jsxs("button",{className:`pinout-comp-item ${c===o?"active":""}`,onClick:()=>{r(c),i(null),d(null)},children:[e.jsx("span",{className:"pinout-comp-des",children:a.designator||"—"}),e.jsx("span",{className:"pinout-comp-name",children:a.name}),e.jsx("span",{className:"pinout-comp-cnt",children:a.pin_count})]},a.id)})}),e.jsxs("div",{className:"pinout-legend",children:[e.jsx("div",{className:"pinout-legend-title",children:"Bus Types"}),e.jsx("div",{className:"pinout-legend-grid",children:b.map(a=>e.jsxs("button",{className:`pinout-legend-chip ${l===a?"active":""}`,onClick:()=>d(c=>c===a?null:a),children:[e.jsx("span",{className:"pinout-legend-swatch",style:{background:N[a]}}),a]},a))})]})]}),e.jsxs("div",{className:"pinout-canvas",onClick:C,children:[!p&&e.jsx("button",{className:"pinout-menu-btn",onClick:a=>{a.stopPropagation(),x(!0)},children:"☰"}),e.jsx(E,{comp:g,selectedBus:l,selectedPin:s,onPinClick:j})]}),s&&n&&e.jsx(L,{pin:s,pos:n,onClose:()=>{i(null),u(null)}})]}):null}function E({comp:t,selectedBus:o,selectedPin:r,onPinClick:l}){const d=m.useRef(null),s=t.geometry;if(!s)return null;const i=s.pad_bbox,n=10,u=(i.max_x-i.min_x+n*2)*f,p=(i.max_y-i.min_y+n*2)*f,x=(-i.min_x+n)*f,h=(-i.min_y+n)*f,y=x+s.x*f,g=h+s.y*f,v=s.width*f,b=s.height*f;return e.jsxs("div",{className:"pinout-diagram-wrap",children:[e.jsxs("div",{className:"pinout-diagram-header",children:[e.jsx("span",{className:"pinout-diagram-name",children:t.name}),t.designator&&e.jsx("span",{className:"pinout-diagram-des",children:t.designator}),t.package&&e.jsx("span",{className:"pinout-diagram-pkg",children:t.package}),t.module_type&&e.jsx("span",{className:"pinout-diagram-type",children:t.module_type})]}),e.jsx("div",{className:"pinout-diagram-scroll",children:e.jsxs("div",{ref:d,className:"pinout-diagram",style:{width:u,height:p,position:"relative"},children:[e.jsxs("div",{className:"pinout-chip-body",style:{left:y,top:g,width:v,height:b},children:[e.jsx("div",{className:"pinout-chip-dot"}),e.jsx("div",{className:"pinout-chip-label",children:t.designator||t.name}),t.module_type&&e.jsx("div",{className:"pinout-chip-sublabel",children:t.module_type})]}),t.pins.map(j=>j.x==null||j.y==null?null:e.jsx(I,{pin:j,originX:x,originY:h,selectedBus:o,isSelected:r?.number===j.number,onPinClick:l},j.number))]})})]})}function I({pin:t,originX:o,originY:r,selectedBus:l,isSelected:d,onPinClick:s}){const i=w(t),n=(t.w||.5)*f,u=(t.h||.5)*f,p=o+t.x*f,x=r+t.y*f;let h=!1;if(l){const g=t.active_function?.type,v=(t.type==="power"||t.type==="ground")&&l==="Power";h=g!==l&&!v}const y=t.active_function?.name||"";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`pinout-pad ${h?"faded":""} ${d?"selected":""}`,style:{left:p-n/2,top:x-u/2,width:n,height:u,background:i},onClick:g=>s(t,g)}),e.jsx("div",{className:`pinout-pin-label ${t.side} ${h?"faded":""}`,style:_(t,p,x,n,u,"name"),children:t.name}),y&&e.jsx("div",{className:`pinout-fn-label ${t.side} ${h?"faded":""}`,style:_(t,p,x,n,u,"fn"),children:y})]})}function _(t,o,r,l,d,s){const i=A,n=s==="name";switch(t.side){case"left":return{position:"absolute",left:n?o-l/2-i:o+l/2+i,top:r,transform:"translateY(-50%)",textAlign:n?"right":"left",transformOrigin:n?"right center":"left center"};case"right":return{position:"absolute",left:n?o+l/2+i:o-l/2-i,top:r,transform:"translateY(-50%)",textAlign:n?"left":"right",transformOrigin:n?"left center":"right center"};case"top":return{position:"absolute",left:o,top:n?r-d/2-i:r+d/2+i,transform:"translateX(-50%) rotate(-90deg)",transformOrigin:"center center",textAlign:n?"left":"right"};case"bottom":return{position:"absolute",left:o,top:n?r+d/2+i:r-d/2-i,transform:"translateX(-50%) rotate(-90deg)",transformOrigin:"center center",textAlign:n?"right":"left"};default:return{position:"absolute",left:o,top:r}}}function L({pin:t,pos:o,onClose:r}){const l=m.useRef(null),[d,s]=m.useState(o);m.useEffect(()=>{if(l.current){const n=l.current.getBoundingClientRect();let u=o.x+12,p=o.y-20;u+n.width>window.innerWidth&&(u=o.x-n.width-12),p+n.height>window.innerHeight&&(p=window.innerHeight-n.height-8),p<4&&(p=4),s({x:u,y:p})}},[o]);const i=w(t);return e.jsxs("div",{ref:l,className:"pinout-detail",style:{left:d.x,top:d.y},onClick:n=>n.stopPropagation(),children:[e.jsx("button",{className:"pinout-detail-close",onClick:r,children:"×"}),e.jsxs("div",{className:"pinout-detail-header",children:[e.jsxs("span",{className:"pinout-detail-num",children:["Pin ",t.number]}),e.jsx("span",{className:"pinout-detail-name",children:t.name}),e.jsx("span",{className:"pinout-detail-type",style:{background:i},children:t.type})]}),t.active_function&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pinout-detail-section",children:"Active"}),e.jsxs("div",{className:"pinout-detail-fn",children:[e.jsx("span",{className:"pinout-detail-dot",style:{background:N[t.active_function.type]||"#666"}}),e.jsx("span",{className:"pinout-detail-fn-name",children:t.active_function.name}),e.jsx("span",{className:"pinout-detail-fn-type",children:t.active_function.type})]})]}),t.alternate_functions.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pinout-detail-section",children:"Alternates"}),t.alternate_functions.map((n,u)=>e.jsxs("div",{className:"pinout-detail-fn",children:[e.jsx("span",{className:"pinout-detail-dot",style:{background:N[n.type]||"#666"}}),e.jsx("span",{className:"pinout-detail-fn-name",children:n.name}),e.jsx("span",{className:"pinout-detail-fn-type",children:n.type})]},u))]}),t.pad_count&&t.pad_count>1&&e.jsxs("div",{className:"pinout-detail-meta",children:[t.pad_count," pads connected"]})]})}P();function F(){const[t,o]=m.useState(null),[r,l]=m.useState(null);return m.useEffect(()=>{const d=window.__PINOUT_CONFIG__;if(!d?.dataUrl){l("No pinout data URL configured");return}fetch(d.dataUrl).then(s=>{if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}).then(s=>{!s.components||s.components.length===0?l("No components with 5+ pins found. Build your project first."):o(s)}).catch(s=>l(`Failed to load pinout data: ${s.message}`))},[]),r?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",color:"var(--vscode-descriptionForeground, #888)",fontFamily:"var(--vscode-font-family, system-ui)",fontSize:13,padding:24,textAlign:"center"},children:r}):t?e.jsx(R,{data:t}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",color:"var(--vscode-descriptionForeground, #888)",fontFamily:"var(--vscode-font-family, system-ui)",fontSize:13},children:"Loading..."})}S.createRoot(document.getElementById("root")).render(e.jsx(k.StrictMode,{children:e.jsx(F,{})}));
